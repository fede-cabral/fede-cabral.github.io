<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor Pro - FORJAX</title>

<link rel="stylesheet" href="style.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- XLSX (Excel Export) -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

</head>
<body>

<div id="loginScreen" class="login">
    <h2>ğŸ” Gestor Pro - FORJAX</h2>
    <input id="userInput" placeholder="Usuario">
    <button onclick="login()">Entrar</button>
</div>

<div id="app">

<header>
...
</footer>

</div>
<div id="app">
<header>

    <h1>ğŸ“Š Gestor Personal Pro</h1>
    <p>OperaciÃ³n TranseconÃ³mico</p>

    <button onclick="logout()" class="logout-btn">
        Cerrar SesiÃ³n
    </button>

</header>

<main>

<!-- INGRESOS -->
<section class="card">
<h2>ğŸ’¼ Ingresos</h2>

<input id="incomeDesc" placeholder="DescripciÃ³n">
<input id="incomeAmount" type="number" placeholder="Monto">

<button onclick="addIncome()">Agregar</button>

<ul id="incomeList"></ul>

<p>Total: $<span id="incomeTotal">0</span></p>
</section>


<!-- TAREAS -->
<section class="card">
<h2>ğŸ“Œ Tareas</h2>

<input id="taskInput" placeholder="Nueva tarea">
<button onclick="addTask()">Agregar</button>

<ul id="taskList"></ul>
</section>


<!-- GASTOS -->
<section class="card">
<h2>ğŸ’° Gastos</h2>

<input id="descInput" placeholder="DescripciÃ³n">

<select id="categoryInput">
  <option value="Comida">ğŸ” Comida</option>
  <option value="Servicios">ğŸ’¡ Servicios</option>
  <option value="Transporte">ğŸš— Transporte</option>
  <option value="Estudio">ğŸ“š Estudio</option>
  <option value="Otros">ğŸ“¦ Otros</option>
</select>
    
<input id="amountInput" type="number" placeholder="Monto">

<button onclick="addExpense()">Agregar</button>

<ul id="expenseList"></ul>

<p>Total: $<span id="expenseTotal">0</span></p>
</section>


<!-- METAS -->
<section class="card">
    <h2>ğŸ“… Presupuesto Mensual</h2>

    <input type="number" id="budgetInput" placeholder="Presupuesto del mes">

    <button onclick="setBudget()">Guardar</button>

    <p>Presupuesto: $<span id="budgetTotal">0</span></p>
    <p>Disponible: $<span id="budgetAvailable">0</span></p>
</section>

<!-- BALANCE -->
<section class="card wide">

<h2>ğŸ“ˆ Balance General</h2>

    <button onclick="exportExcel()" class="btn-export">
ğŸ“¥ Descargar Excel
</button>
    
<p>Ingresos: $<span id="bIncome">0</span></p>
<p>Gastos: $<span id="bExpense">0</span></p>

<h3 id="balanceText"></h3>

<canvas id="chart"></canvas>

</section>

</main>


<footer>
<p>Creado por FORJAX - 2026</p>
</footer>


<script>

/* ================= LOGIN ================= */

let currentUser = localStorage.getItem("currentUser");

function login(){

    const user = document.getElementById("userInput").value.trim();

    if(user.length < 3){
        alert("El usuario debe tener al menos 3 caracteres");
        return;
    }

    if(!/^[a-zA-Z0-9_]+$/.test(user)){
        alert("Solo letras, nÃºmeros o guiÃ³n bajo");
        return;
    }

    localStorage.setItem("currentUser", user.toLowerCase());
    location.reload();
}
function logout(){

    localStorage.removeItem("currentUser");

    location.reload();
}

if(!currentUser){
    app.style.display = "none";
    document.getElementById("userInput").focus();
}

    document.body.innerHTML = document.getElementById("loginScreen").outerHTML;

}

/* ================= DATOS ================= */

const prefix = currentUser + "_";

let tasks    = JSON.parse(localStorage.getItem(prefix+"tasks"))    || [];
let incomes  = JSON.parse(localStorage.getItem(prefix+"incomes"))  || [];
let expenses = JSON.parse(localStorage.getItem(prefix+"expenses")) || [];
let budget   = Number(localStorage.getItem(prefix+"budget")) || 0;

/* ================= ELEMENTOS ================= */

const taskInput = document.getElementById("taskInput");
const taskList  = document.getElementById("taskList");

const incomeDesc   = document.getElementById("incomeDesc");
const incomeAmount = document.getElementById("incomeAmount");
const incomeList   = document.getElementById("incomeList");
const incomeTotal  = document.getElementById("incomeTotal");

const descInput   = document.getElementById("descInput");
const amountInput = document.getElementById("amountInput");
    const categoryInput = document.getElementById("categoryInput");
const expenseList = document.getElementById("expenseList");
const expenseTotal= document.getElementById("expenseTotal");

const bIncome  = document.getElementById("bIncome");
const bExpense = document.getElementById("bExpense");
const balanceText = document.getElementById("balanceText");

const budgetTotal = document.getElementById("budgetTotal");
const budgetAvailable = document.getElementById("budgetAvailable");

/* ================= FORMATEO ================= */

function formatMoney(value){
    return Number(value).toLocaleString("es-AR");
}
    
/* ================= GUARDAR ================= */

function saveData() {

    localStorage.setItem(prefix+"tasks", JSON.stringify(tasks));
    localStorage.setItem(prefix+"expenses", JSON.stringify(expenses));
    localStorage.setItem(prefix+"incomes", JSON.stringify(incomes));
    localStorage.setItem(prefix+"budget", budget);

}


/* ================= RENDER ================= */

let chart;

function render(){

/* TAREAS */

taskList.innerHTML="";

tasks.forEach((t,i)=>{

    const li=document.createElement("li");
    li.textContent=t;

    li.onclick=()=>{
        tasks.splice(i,1);
        saveData();
        render();
    };

    taskList.appendChild(li);

});


/* INGRESOS */

incomeList.innerHTML="";
let totalInc=0;

incomes.forEach((e,i)=>{

    const li=document.createElement("li");
    li.textContent=`${e.desc} - $${formatMoney(e.amount)}`;

    li.onclick=()=>{
        incomes.splice(i,1);
        saveData();
        render();
    };

    totalInc+=Number(e.amount);

    incomeList.appendChild(li);

});

incomeTotal.textContent=formatMoney(totalInc);

/* GASTOS */

expenseList.innerHTML="";
let totalExp=0;

/* ORDENAR GASTOS DE MAYOR A MENOR */
expenses.sort((a,b)=> b.amount - a.amount);

expenses.forEach((e,i)=>{

    const li=document.createElement("li");
    li.textContent=`${e.desc} (${e.category}) - $${formatMoney(e.amount)}`;

    li.onclick=()=>{
        expenses.splice(i,1);
        saveData();
        render();
    };

    totalExp+=Number(e.amount);

    expenseList.appendChild(li);

});

expenseTotal.textContent=formatMoney(totalExp);


/* ================= PRESUPUESTO ================= */

let spent = totalExp;

budgetTotal.textContent = formatMoney(budget);

let available = budget - spent;

budgetAvailable.textContent = formatMoney(available);

if(available < 0){
    alert("âš  EstÃ¡s excediendo tu presupuesto mensual");
    budgetAvailable.style.color = "red";
}else{
    budgetAvailable.style.color = "lime";
}


/* ================= BALANCE ================= */

bIncome.textContent=formatMoney(totalInc);
bExpense.textContent=formatMoney(totalExp);

const balance=totalInc-totalExp;

if(balance>0){
    balanceText.textContent=`ğŸŸ¢ Vas ganando $${formatMoney(balance)}`;
    balanceText.style.color="lime";
}
else if(balance<0){
    balanceText.textContent=`ğŸ”´ EstÃ¡s perdiendo $${formatMoney(Math.abs(balance))}`;
    balanceText.style.color="red";
}
else{
    balanceText.textContent="âšª En equilibrio";
    balanceText.style.color="white";
}


/* ================= GRAFICO ================= */

if(chart) chart.destroy();

const ctx=document.getElementById("chart");

chart=new Chart(ctx,{
    type:"bar",
    data:{
        labels:["Ingresos","Gastos","Balance"],
        datasets:[{
            label:"Balance",
            data:[totalInc,totalExp,totalInc-totalExp],
            backgroundColor:["#22c55e","#ef4444","#3b82f6"]
        }]
    },
    options:{
        responsive:true,
        plugins:{
            legend:{display:false}
        }
    }
});

}


/* ================= BOTONES ================= */

function addTask(){

    if(!taskInput.value) return;

    tasks.push(taskInput.value);
    taskInput.value="";

    saveData();
    render();
}


function addIncome(){

   if(!incomeDesc.value.trim()) return;

const amount = Number(incomeAmount.value);

if(isNaN(amount) || amount <= 0){
    alert("Monto invÃ¡lido");
    return;
}

    incomes.push({
        desc:incomeDesc.value,
        amount:incomeAmount.value
    });

    incomeDesc.value="";
    incomeAmount.value="";

    saveData();
    render();
}

function addExpense(){

    if(!descInput.value.trim()) return;

    const amount = Number(amountInput.value);

    if(isNaN(amount) || amount <= 0){
        alert("Monto invÃ¡lido");
        return;
    }

    expenses.push({
        desc: descInput.value,
        amount: amount,
        category: categoryInput.value
    });

    descInput.value="";
    amountInput.value="";
    categoryInput.selectedIndex = 0;

    saveData();
    render();
}

function setBudget(){

    const input = document.getElementById("budgetInput");

    if(input.value === "") return;

    budget = Number(input.value);

    input.value = "";

    saveData();
    render();
}


/* ================= INICIO ================= */

render();
function exportExcel(){

    let data = [
        ["GESTOR PERSONAL PRO - FORJAX"],
        ["Operacion Transeconomico"],
        [],
        ["INGRESOS"],
        ["Descripcion","Monto"]
    ];

    incomes.forEach(i=>{
        data.push([i.desc, i.amount]);
    });

    data.push([]);
    data.push(["Total Ingresos", bIncome.textContent]);
    data.push([]);

    data.push(["GASTOS"]);
    data.push(["Descripcion","Monto"]);

    expenses.forEach(e=>{
        data.push([e.desc, e.amount]);
    });

    data.push([]);
    data.push(["Total Gastos", bExpense.textContent]);
    data.push([]);

    data.push(["PRESUPUESTO"]);
    data.push(["Presupuesto", budget]);
    data.push(["Disponible", budgetAvailable.textContent]);

    data.push([]);
    data.push(["BALANCE FINAL", balanceText.textContent]);

    let wb = XLSX.utils.book_new();
    let ws = XLSX.utils.aoa_to_sheet(data);

    XLSX.utils.book_append_sheet(wb, ws, "Resumen");

    XLSX.writeFile(wb,"forjax_finanzas.xlsx");
}
    document.addEventListener("keydown", function(e){

    if(e.key === "Enter"){
        if(document.activeElement === taskInput) addTask();
        if(document.activeElement === incomeAmount) addIncome();
        if(document.activeElement === amountInput) addExpense();
    }

});
    
</script>
</div>
</body>
</html>
