<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor Pro - FORJAX</title>

<link rel="stylesheet" href="style.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- XLSX (Excel Export) -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

</head>

<body>

<header>
    <h1>ðŸ“Š Gestor Personal Pro</h1>
    <p>OperaciÃ³n TranseconÃ³mico</p>
</header>

<main>

<!-- INGRESOS -->
<section class="card">
<h2>ðŸ’¼ Ingresos</h2>

<input id="incomeDesc" placeholder="DescripciÃ³n">
<input id="incomeAmount" type="number" placeholder="Monto">

<button onclick="addIncome()">Agregar</button>

<ul id="incomeList"></ul>

<p>Total: $<span id="incomeTotal">0</span></p>
</section>


<!-- TAREAS -->
<section class="card">
<h2>ðŸ“Œ Tareas</h2>

<input id="taskInput" placeholder="Nueva tarea">
<button onclick="addTask()">Agregar</button>

<ul id="taskList"></ul>
</section>


<!-- GASTOS -->
<section class="card">
<h2>ðŸ’° Gastos</h2>

<input id="descInput" placeholder="DescripciÃ³n">
<input id="amountInput" type="number" placeholder="Monto">

<button onclick="addExpense()">Agregar</button>

<ul id="expenseList"></ul>

<p>Total: $<span id="expenseTotal">0</span></p>
</section>


<!-- METAS -->
<section class="card">
    <h2>ðŸ“… Presupuesto Mensual</h2>

    <input type="number" id="budgetInput" placeholder="Presupuesto del mes">

    <button onclick="setBudget()">Guardar</button>

    <p>Presupuesto: $<span id="budgetTotal">0</span></p>
    <p>Disponible: $<span id="budgetAvailable">0</span></p>
</section>

<!-- BALANCE -->
<section class="card wide">

<h2>ðŸ“ˆ Balance General</h2>

    <button onclick="exportExcel()" class="btn-export">
ðŸ“¥ Descargar Excel
</button>
    
<p>Ingresos: $<span id="bIncome">0</span></p>
<p>Gastos: $<span id="bExpense">0</span></p>

<h3 id="balanceText"></h3>

<canvas id="chart"></canvas>

</section>

</main>


<footer>
<p>Creado por FORJAX - 2026</p>
</footer>


<script>

/* ================= DATOS ================= */

let tasks    = JSON.parse(localStorage.getItem("tasks"))    || [];
let incomes  = JSON.parse(localStorage.getItem("incomes"))  || [];
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let budget   = Number(localStorage.getItem("budget")) || 0;


/* ================= ELEMENTOS ================= */

const taskInput = document.getElementById("taskInput");
const taskList  = document.getElementById("taskList");

const incomeDesc   = document.getElementById("incomeDesc");
const incomeAmount = document.getElementById("incomeAmount");
const incomeList   = document.getElementById("incomeList");
const incomeTotal  = document.getElementById("incomeTotal");

const descInput   = document.getElementById("descInput");
const amountInput = document.getElementById("amountInput");
const expenseList = document.getElementById("expenseList");
const expenseTotal= document.getElementById("expenseTotal");

const bIncome  = document.getElementById("bIncome");
const bExpense = document.getElementById("bExpense");
const balanceText = document.getElementById("balanceText");

const budgetTotal = document.getElementById("budgetTotal");
const budgetAvailable = document.getElementById("budgetAvailable");


/* ================= GUARDAR ================= */

function saveData() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
    localStorage.setItem("expenses", JSON.stringify(expenses));
    localStorage.setItem("incomes", JSON.stringify(incomes));
    localStorage.setItem("budget", budget);
}


/* ================= RENDER ================= */

let chart;

function render(){

/* TAREAS */

taskList.innerHTML="";

tasks.forEach((t,i)=>{

    const li=document.createElement("li");
    li.textContent=t;

    li.onclick=()=>{
        tasks.splice(i,1);
        saveData();
        render();
    };

    taskList.appendChild(li);

});


/* INGRESOS */

incomeList.innerHTML="";
let totalInc=0;

incomes.forEach((e,i)=>{

    const li=document.createElement("li");
    li.textContent=`${e.desc} - $${e.amount}`;

    li.onclick=()=>{
        incomes.splice(i,1);
        saveData();
        render();
    };

    totalInc+=Number(e.amount);

    incomeList.appendChild(li);

});

incomeTotal.textContent=totalInc;


/* GASTOS */

expenseList.innerHTML="";
let totalExp=0;

expenses.forEach((e,i)=>{

    const li=document.createElement("li");
    li.textContent=`${e.desc} - $${e.amount}`;

    li.onclick=()=>{
        expenses.splice(i,1);
        saveData();
        render();
    };

    totalExp+=Number(e.amount);

    expenseList.appendChild(li);

});

expenseTotal.textContent=totalExp;


/* ================= PRESUPUESTO ================= */

let spent = totalExp;

budgetTotal.textContent = budget;

let available = budget - spent;

budgetAvailable.textContent = available;

if(available < 0){
    budgetAvailable.style.color = "red";
}else{
    budgetAvailable.style.color = "lime";
}


/* ================= BALANCE ================= */

bIncome.textContent=totalInc;
bExpense.textContent=totalExp;

const balance=totalInc-totalExp;

if(balance>0){
    balanceText.textContent=`ðŸŸ¢ Vas ganando $${balance}`;
    balanceText.style.color="lime";
}
else if(balance<0){
    balanceText.textContent=`ðŸ”´ EstÃ¡s perdiendo $${Math.abs(balance)}`;
    balanceText.style.color="red";
}
else{
    balanceText.textContent="âšª En equilibrio";
    balanceText.style.color="white";
}


/* ================= GRAFICO ================= */

if(chart) chart.destroy();

const ctx=document.getElementById("chart");

chart=new Chart(ctx,{
    type:"bar",
    data:{
        labels:["Ingresos","Gastos"],
        datasets:[{
            label:"Balance",
            data:[totalInc,totalExp],
            backgroundColor:["#22c55e","#ef4444"]
        }]
    },
    options:{
        responsive:true,
        plugins:{
            legend:{display:false}
        }
    }
});

}


/* ================= BOTONES ================= */

function addTask(){

    if(!taskInput.value) return;

    tasks.push(taskInput.value);
    taskInput.value="";

    saveData();
    render();
}


function addIncome(){

    if(!incomeDesc.value || !incomeAmount.value) return;

    incomes.push({
        desc:incomeDesc.value,
        amount:incomeAmount.value
    });

    incomeDesc.value="";
    incomeAmount.value="";

    saveData();
    render();
}


function addExpense(){

    if(!descInput.value || !amountInput.value) return;

    expenses.push({
        desc:descInput.value,
        amount:amountInput.value
    });

    descInput.value="";
    amountInput.value="";

    saveData();
    render();
}


function setBudget(){

    const input = document.getElementById("budgetInput");

    if(input.value === "") return;

    budget = Number(input.value);

    input.value = "";

    saveData();
    render();
}


/* ================= INICIO ================= */

render();
function exportExcel(){

    let data = [
        ["GESTOR PERSONAL PRO - FORJAX"],
        ["Operacion Transeconomico"],
        [],
        ["INGRESOS"],
        ["Descripcion","Monto"]
    ];

    incomes.forEach(i=>{
        data.push([i.desc, i.amount]);
    });

    data.push([]);
    data.push(["Total Ingresos", bIncome.textContent]);
    data.push([]);

    data.push(["GASTOS"]);
    data.push(["Descripcion","Monto"]);

    expenses.forEach(e=>{
        data.push([e.desc, e.amount]);
    });

    data.push([]);
    data.push(["Total Gastos", bExpense.textContent]);
    data.push([]);

    data.push(["PRESUPUESTO"]);
    data.push(["Presupuesto", budget]);
    data.push(["Disponible", budgetAvailable.textContent]);

    data.push([]);
    data.push(["BALANCE FINAL", balanceText.textContent]);

    let wb = XLSX.utils.book_new();
    let ws = XLSX.utils.aoa_to_sheet(data);

    XLSX.utils.book_append_sheet(wb, ws, "Resumen");

    XLSX.writeFile(wb,"forjax_finanzas.xlsx");
}
    
</script>

</body>
</html>
